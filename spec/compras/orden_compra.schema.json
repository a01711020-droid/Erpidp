{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OrdenCompra",
  "description": "Esquema de datos para una orden de compra",
  "type": "object",
  "required": [
    "orden_compra_id",
    "folio",
    "obra_id",
    "proveedor_id",
    "fecha_emision",
    "fecha_entrega",
    "estado",
    "subtotal",
    "total",
    "items"
  ],
  "properties": {
    "orden_compra_id": {
      "type": "string",
      "format": "uuid",
      "description": "ID único de la orden de compra"
    },
    "folio": {
      "type": "string",
      "description": "Folio estructurado (ej: 227-A01GM-CEMEX)",
      "pattern": "^[0-9]{3}-[A-Z][0-9]{2}[A-Z]{2}-[A-Z0-9\\s]+$"
    },
    "obra_id": {
      "type": "string",
      "format": "uuid",
      "description": "ID de la obra asociada"
    },
    "proveedor_id": {
      "type": "string",
      "format": "uuid",
      "description": "ID del proveedor"
    },
    "requisicion_id": {
      "type": ["string", "null"],
      "format": "uuid",
      "description": "ID de la requisición origen (si aplica)"
    },
    "fecha_emision": {
      "type": "string",
      "format": "date",
      "description": "Fecha de emisión de la OC (YYYY-MM-DD)"
    },
    "fecha_entrega": {
      "type": "string",
      "format": "date",
      "description": "Fecha programada de entrega (YYYY-MM-DD)"
    },
    "estado": {
      "type": "string",
      "enum": ["borrador", "emitida", "parcialmente_pagada", "pagada", "cancelada"],
      "description": "Estado actual de la orden"
    },
    "tipo_entrega": {
      "type": ["string", "null"],
      "enum": ["en_obra", "bodega", "recoger", null],
      "description": "Tipo de entrega"
    },
    "subtotal": {
      "type": "number",
      "minimum": 0,
      "description": "Subtotal antes de impuestos y descuentos"
    },
    "descuento_porcentaje": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "default": 0,
      "description": "Porcentaje de descuento"
    },
    "descuento_monto": {
      "type": "number",
      "minimum": 0,
      "default": 0,
      "description": "Monto del descuento aplicado"
    },
    "iva": {
      "type": "number",
      "minimum": 0,
      "default": 0,
      "description": "Monto del IVA (16%)"
    },
    "total": {
      "type": "number",
      "minimum": 0,
      "description": "Total final (subtotal - descuento + IVA)"
    },
    "monto_pagado": {
      "type": "number",
      "minimum": 0,
      "default": 0,
      "description": "Monto ya pagado de la orden"
    },
    "saldo_pendiente": {
      "type": "number",
      "minimum": 0,
      "description": "Saldo pendiente de pago (total - monto_pagado)"
    },
    "observaciones": {
      "type": ["string", "null"],
      "description": "Observaciones adicionales"
    },
    "creado_por": {
      "type": ["string", "null"],
      "description": "Usuario que creó la orden"
    },
    "items": {
      "type": "array",
      "minItems": 1,
      "description": "Items de la orden de compra",
      "items": {
        "$ref": "#/definitions/ItemOrdenCompra"
      }
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Fecha de creación del registro"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Fecha de última actualización"
    }
  },
  "definitions": {
    "ItemOrdenCompra": {
      "type": "object",
      "required": [
        "item_id",
        "cantidad",
        "unidad",
        "descripcion",
        "precio_unitario",
        "total"
      ],
      "properties": {
        "item_id": {
          "type": "string",
          "format": "uuid",
          "description": "ID único del item"
        },
        "cantidad": {
          "type": "number",
          "minimum": 0,
          "exclusiveMinimum": true,
          "description": "Cantidad del item"
        },
        "unidad": {
          "type": "string",
          "description": "Unidad de medida (M3, BULTO, PZA, KG, etc.)"
        },
        "descripcion": {
          "type": "string",
          "description": "Descripción del material o servicio"
        },
        "precio_unitario": {
          "type": "number",
          "minimum": 0,
          "description": "Precio unitario del item"
        },
        "total": {
          "type": "number",
          "minimum": 0,
          "description": "Total del item (cantidad * precio_unitario)"
        }
      }
    }
  }
}
